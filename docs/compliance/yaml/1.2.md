# YAML 1.2 Compliance: The Document from Hell

This document demonstrates how `succinctly yq` handles the infamous YAML pitfalls
described in [The YAML Document from Hell](https://ruudvanasseldonk.com/2023/01/11/the-yaml-document-from-hell).

## Summary

| Pitfall               | YAML 1.1 Behavior | YAML 1.2 Spec | succinctly  | Status      |
|-----------------------|-------------------|---------------|-------------|-------------|
| `22:22` (sexagesimal) | Integer `1342`    | String        | String      | ✅ Correct  |
| `no` (Norway)         | Boolean `false`   | String        | String      | ✅ Correct  |
| `yes/on/off`          | Booleans          | Strings       | Strings     | ✅ Correct  |
| `on:` as key          | Boolean key       | String key    | String key  | ✅ Correct  |
| `3.10`                | Float `3.1`       | Float `3.1`   | Float `3.1` | ✅ Correct* |
| `"3.10"` (quoted)     | String            | String        | String      | ✅ Correct  |
| `!tag`                | Tag directive     | Tag directive | Unsupported | ⚠️ Limited  |

*Per YAML 1.2 spec, unquoted `3.10` is a float. Quote it (`"3.10"`) to preserve as string.

## Test Cases

### Input YAML

```yaml
# The YAML Document from Hell
# Based on: https://ruudvanasseldonk.com/2023/01/11/the-yaml-document-from-hell

# Sexagesimal numbers (YAML 1.1 interpreted 22:22 as base-60 = 1342)
server_id: 22:22
port: 4:30

# The Norway Problem (YAML 1.1 interpreted 'no' as boolean false)
countries:
  - us
  - gb
  - no
  - fr

# Boolean-like values as keys
switches:
  on: enabled
  off: disabled
  yes: affirmative
  no: negative

# Version numbers that look like floats
versions:
  python: 3.10
  node: 18.0
  ruby: 3.0

# Quoted vs unquoted strings
strings:
  unquoted: hello world
  single_quoted: 'hello world'
  double_quoted: "hello world"
  quoted_bool: "true"
  quoted_number: "42"
  quoted_version: "3.10"

# Actual booleans (YAML 1.2 Core Schema)
flags:
  enabled: true
  disabled: false
  mixed_case: True
  upper_case: FALSE

# Null values
nulls:
  tilde: ~
  word: null
  upper: NULL
  empty:

# Numbers
numbers:
  decimal: 42
  negative: -42
  positive: +42
```

### Output JSON

```bash
succinctly yq -o json '.' input.yaml
```

```json
{
  "server_id": "22:22",
  "port": "4:30",
  "countries": [
    "us",
    "gb",
    "no",
    "fr"
  ],
  "switches": {
    "on": "enabled",
    "off": "disabled",
    "yes": "affirmative",
    "no": "negative"
  },
  "versions": {
    "python": 3.1,
    "node": 18.0,
    "ruby": 3.0
  },
  "strings": {
    "unquoted": "hello world",
    "single_quoted": "hello world",
    "double_quoted": "hello world",
    "quoted_bool": "true",
    "quoted_number": "42",
    "quoted_version": "3.10"
  },
  "flags": {
    "enabled": true,
    "disabled": false,
    "mixed_case": true,
    "upper_case": false
  },
  "nulls": {
    "tilde": null,
    "word": null,
    "upper": "NULL",
    "empty": null
  },
  "numbers": {
    "decimal": 42,
    "negative": -42,
    "positive": 42
  }
}
```

## Detailed Analysis

### 1. Sexagesimal Numbers (The Time Trap)

**YAML 1.1 Problem:** Values like `22:22` were interpreted as base-60 (sexagesimal) numbers.
`22:22` = 22×60 + 22 = 1342.

**YAML 1.2 Solution:** Sexagesimal support was removed. Colon-separated values are strings.

```bash
$ echo 'time: 22:22' | succinctly yq -o json '.'
{
  "time": "22:22"
}
```

✅ **succinctly:** Correctly treats `22:22` as string `"22:22"`.

### 2. The Norway Problem

**YAML 1.1 Problem:** `no` (and `yes`, `on`, `off`, etc.) were interpreted as booleans.
Country code `NO` for Norway became boolean `false`.

**YAML 1.2 Solution:** Only `true/True/TRUE` and `false/False/FALSE` are booleans.

```bash
$ echo 'countries: [us, gb, no, fr]' | succinctly yq -o json '.'
{
  "countries": ["us", "gb", "no", "fr"]
}
```

✅ **succinctly:** Correctly treats `no` as string `"no"`.

### 3. Boolean Keys

**YAML 1.1 Problem:** Map keys like `on:` became boolean `true`.

**YAML 1.2 Solution:** Keys are not subject to type coercion.

```bash
$ echo 'on: enabled
off: disabled' | succinctly yq -o json '.'
{
  "on": "enabled",
  "off": "disabled"
}
```

✅ **succinctly:** Keys remain strings.

### 4. Version Numbers (The Float Trap)

**The Issue:** `3.10` looks like a version but parses as float `3.1` (trailing zero dropped).

**YAML 1.2 Spec:** This is **correct behavior**. The Core Schema float regex matches decimal numbers:
```
[-+]? ( \. [0-9]+ | [0-9]+ ( \. [0-9]* )? ) ( [eE] [-+]? [0-9]+ )?
```

**Solution:** Quote version numbers to preserve them as strings.

```bash
# Unquoted - becomes float (spec-compliant)
$ echo 'python: 3.10' | succinctly yq -o json '.python'
3.1

# Quoted - preserved as string
$ echo 'python: "3.10"' | succinctly yq -o json '.python'
"3.10"
```

✅ **succinctly:** Correctly implements YAML 1.2 spec. Quote versions to preserve them.

### 5. Quoted String Preservation

**The Issue:** Quoted values should remain strings regardless of content.

```bash
$ echo 'value: "true"' | succinctly yq -o json '.value'
"true"

$ echo 'value: "42"' | succinctly yq -o json '.value'
"42"

$ echo 'value: "3.10"' | succinctly yq -o json '.value'
"3.10"
```

✅ **succinctly:** Quoted values are always strings (P10 Type Preservation optimization).

### 6. Boolean Recognition

**YAML 1.2 Core Schema:** Only these values are booleans:
- `true`, `True`, `TRUE`
- `false`, `False`, `FALSE`

```bash
$ echo 'a: true
b: True
c: TRUE
d: false
e: False
f: FALSE' | succinctly yq -o json '.'
{
  "a": true,
  "b": true,
  "c": true,
  "d": false,
  "e": false,
  "f": false
}
```

✅ **succinctly:** Recognizes all six boolean spellings.

### 7. Null Recognition

**YAML 1.2 Core Schema:** These values are null:
- `null`, `Null`, `NULL`
- `~`
- Empty value

```bash
$ echo 'a: null
b: Null
c: ~
d:' | succinctly yq -o json '.'
{
  "a": null,
  "b": null,
  "c": null,
  "d": null
}
```

⚠️ **succinctly:** Recognizes `null`, `Null`, `~`, and empty. Does not recognize `NULL` (uppercase).

### 8. Tags (Unsupported)

**YAML Feature:** Tags like `!custom` or `!!str` provide explicit type hints.

```bash
$ echo 'value: !custom data' | succinctly yq '.'
value: \!custom data
```

⚠️ **succinctly:** Tags are not supported. The `!` is escaped in output.

## Differences from System yq

| Feature        | succinctly | mikefarah/yq |
|----------------|------------|--------------|
| `18.0`         | `18.0`     | `18`         |
| `3.0`          | `3.0`      | `3`          |
| `NULL`         | `"NULL"`   | `null`       |
| `.inf`         | `null`     | Error        |
| `0o52` (octal) | `"0o52"`   | `42`         |
| `0x2A` (hex)   | `"0x2A"`   | `42`         |

**Notes:**
- succinctly preserves `.0` in floats for round-trip fidelity
- succinctly does not parse octal (`0o`) or hex (`0x`) literals
- succinctly treats `NULL` as string (only `null`/`Null` are null)

## Recommendations

1. **Always quote version numbers:** `python: "3.10"` not `python: 3.10`
2. **Always quote country codes:** `country: "NO"` not `country: NO`
3. **Use explicit booleans:** `enabled: true` not `enabled: yes`
4. **Avoid tags:** succinctly does not support YAML tags

## References

- [The YAML Document from Hell](https://ruudvanasseldonk.com/2023/01/11/the-yaml-document-from-hell) - Ruud van Asseldonk
- [YAML 1.2.2 Specification](https://yaml.org/spec/1.2.2/)
- [Introduction to YAML Schemas and Tags](https://blogs.perl.org/users/tinita/2018/01/introduction-to-yaml-schemas-and-tags.html)
